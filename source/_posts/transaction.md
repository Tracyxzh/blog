---
title: transaction
date: 2017-06-08 10:10:54
tags: [oracle, 事务, PL/SQL]
---

## 前言
前段时间在PL/SQL写了一条sql语句，出入了数据，但是数据库中没有数据。后来发现是因为自己对于事务了解不够

## 定义
事务是一条有多条sql语句组成的工作逻辑单元，这些语句要么全部执行成功，要么全部不执行，只要有一条sql语句执行失败，则已执行的sql语句会回滚刀执行之前的状态。

## oracle 事务与SQL Server的区别
在SQL Server中，每一个DML语句都具有一个隐式的事务，语句执行结束时事务被自动提交到服务器端，除非显示的通过一条事务语句开始一个事务，在oracle中，当第一条SQL开始执行时，一个新的事务就开始了，除非显示的地使用COMMIT进行提交，或者使用ROLLBACK进行回滚，或者是退出某个oracle工具时，这些事务才结束，否则SQL语句的操作仅在会话级别进行，没有保存到数据库中。

## COMMIT提交事务
COMMIT语句会结束数据数据库事务，他做了如下几个方面的工作*
* 如果对数据库使用了DML语句进行了修改，那么这些修改就会永久写进数据库中，这时其他用户可以立即看到对事务的修改
* 加在事务上的所有锁及事务所占有的一切资源自动释放。


## ROLLBACK回滚事务
使用ROLLBACK的情形一般有：
* 误删除了数据或更改了错误的数据，使用回滚帮助恢复原始的数据
* 如果触发了一个异常或者sql语句执行失败不能执行事务，使用回滚将数据恢复到初始状态

## SAVEPOINT保存点
默认情况下，ROLLBACK会撤销整个事务，如果编写一个很大的PL/SQL块，使用了很多的DML语句，此时回滚操作的工作量是很大的。PL/SQL提供了语句级别的回滚，允许将一个大的事务分成很多语句级别的小块，每个小块作为一个保存点。

ROLLBACk TO SAVEPOINT 命令执行，将会发生如下几件事情：
* 从保存点以后所做的工作都被撤销，但是保存点未被释放，如果需要，可以再次撤销该保存点
* 自该保存点以后SQL语句就需要的锁和资源都被释放
* 虽然撤销到保存点，但是并不是结束整个事务，SQL语句处理挂起状态。

